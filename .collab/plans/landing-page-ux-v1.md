# DocTalk 登录页 UX 改进计划 v1

**日期**: 2026-02-05
**作者**: Claude Code (CC)
**状态**: 待 Codex 审核

---

## 问题描述

当前 DocTalk 登录页直接让用户上传文件，无需登录即可使用。这与主流 AI Web App 的最佳实践不符：

| 问题 | 风险等级 | 说明 |
|------|---------|------|
| 文档无用户绑定 | 高 | 敏感文档无访问控制，UUID 可猜测风险 |
| 无使用追踪 | 中 | 无法统计用户行为，难以优化产品 |
| 付费转化困难 | 高 | 用户无账号，Credits 系统无法关联 |
| 数据持久性差 | 中 | 依赖 localStorage，换设备丢失 |

---

## 竞品分析摘要

| 应用 | 游客模式 | 文档上传前需登录 | 认证方式 |
|------|---------|-----------------|---------|
| ChatGPT | ✅ 有 | N/A（无文档） | Email/SSO |
| Claude.ai | ❌ 无 | N/A | Email/SSO |
| Perplexity | ✅ 有 | N/A | 无密码 (Magic Link) |
| **NotebookLM** | ❌ 无 | ✅ **必须** | Google SSO |
| Notion AI | ❌ 无 | ✅ 必须 | Email/SSO |
| DocTalk (当前) | ✅ 实际有 | ❌ 不需要 | Google OAuth (可选) |

**关键洞察**: 所有文档类 AI 应用（NotebookLM, Notion）都要求用户登录后才能上传文档。这是数据安全的基本要求。

---

## 推荐方案：分层认证模型

### 核心原则

1. **Allow Try Before Buy** - 让用户体验价值再要求登录
2. **Require Auth for Sensitive Actions** - 文档上传必须登录
3. **Minimize Friction** - 使用 SSO + Magic Link 减少摩擦
4. **Incentivize Signup** - 用功能引导注册

### 用户旅程设计

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                           LANDING PAGE (/)                                  │
│                                                                             │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                           DocTalk                                    │   │
│  │         "与你的 PDF 对话，智能引用，精准定位"                          │   │
│  │                                                                      │   │
│  │    ┌────────────────────┐    ┌────────────────────┐                 │   │
│  │    │  📄 试用示例 PDF   │    │  ⬆️ 上传你的 PDF   │                 │   │
│  │    │   (无需登录)       │    │   (需要登录)       │                 │   │
│  │    └────────────────────┘    └────────────────────┘                 │   │
│  │                                                                      │   │
│  │    ────────────── 或 ──────────────                                 │   │
│  │                                                                      │   │
│  │    [Google 登录]  [Email 登录 (Magic Link)]                         │   │
│  │                                                                      │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │  已登录用户: 显示 "我的文档" 列表                                     │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────────────┘

                    │                              │
                    ▼                              ▼
┌─────────────────────────────────┐   ┌─────────────────────────────────┐
│      DEMO MODE (无需登录)        │   │     AUTH FLOW (登录流程)        │
│                                 │   │                                 │
│  • 预加载示例 PDF               │   │  1. 点击 "上传你的 PDF"         │
│  • 完整对话体验                 │   │  2. 显示登录模态框              │
│  • 最多 5 条消息                │   │  3. Google SSO / Magic Link     │
│  • 不保存历史                   │   │  4. 登录成功 → 显示上传区域     │
│                                 │   │  5. 上传 → 处理 → 进入阅读页    │
│  完成后显示:                    │   │                                 │
│  "登录以保存对话并上传自己的PDF" │   │                                 │
└─────────────────────────────────┘   └─────────────────────────────────┘
```

### 功能分层

| 功能 | 游客 (未登录) | 免费用户 (已登录) | Pro 用户 |
|------|-------------|-----------------|---------|
| 试用示例 PDF | ✅ | ✅ | ✅ |
| 对话消息数 | 5 条/天 | 20 条/天 | 无限 |
| 上传个人 PDF | ❌ | ✅ (最多 3 个) | 无限 |
| 保存对话历史 | ❌ | ✅ | ✅ |
| 多设备同步 | ❌ | ✅ | ✅ |
| 选择 LLM 模型 | ❌ | 部分 | 全部 |
| 导出对话 | ❌ | ❌ | ✅ |

---

## 技术实现方案

### Phase 1: 登录前置 (MVP 增强)

**目标**: 上传文档前必须登录，保持简单

**改动**:

1. **Landing Page (`/app/page.tsx`)**
   - 新增 "试用示例 PDF" 按钮 → 跳转 `/demo`
   - 修改上传区域：未登录时显示 "登录后上传"
   - 点击上传区域 → 触发 `signIn()` → 回调后显示真正的上传区域

2. **Demo Page (`/app/demo/page.tsx`)** (新建)
   - 预加载一个示例 PDF (存 public/ 或 CDN)
   - 完整 PDF 阅读 + 对话体验
   - 消息限制 (5 条)
   - 底部 CTA: "登录以保存对话并上传自己的 PDF"

3. **后端: 文档关联用户 (`documents.py`)**
   - 上传接口要求 `Authorization` header
   - `Document.user_id` 字段必填 (已有)
   - 列表接口按 `user_id` 过滤

4. **前端: 文档列表改为服务端**
   - 移除 localStorage `doctalk_docs`
   - 新增 `GET /api/documents` 接口 (按用户)
   - Landing page 从 API 获取文档列表

### Phase 2: 认证增强 (可选)

1. **Magic Link 登录**
   - 添加 Email Provider 到 NextAuth
   - 发送一次性登录链接
   - 无需密码，降低摩擦

2. **Microsoft SSO**
   - 对企业用户友好
   - 配置 Azure AD Provider

3. **使用限制执行**
   - 后端中间件检查每日消息配额
   - 免费用户: 20 条/天
   - 超限返回 HTTP 429

---

## UI/UX 详细设计

### 登录页改动

**当前 (Before)**:
```
┌─────────────────────────────────┐
│         DocTalk                 │
│   Upload a PDF to start        │
│                                 │
│   ┌─────────────────────────┐   │
│   │  Drag & drop your PDF   │   │
│   │  [Choose File]          │   │
│   └─────────────────────────┘   │
│                                 │
│   My Documents                  │
│   - doc1.pdf                    │
│   - doc2.pdf                    │
└─────────────────────────────────┘
```

**改后 (After - 未登录)**:
```
┌─────────────────────────────────────────────────────┐
│                    DocTalk                          │
│      与你的 PDF 对话，智能引用，精准定位            │
│                                                     │
│  ┌──────────────────┐  ┌──────────────────┐        │
│  │  📄 试用示例     │  │  ⬆️ 上传 PDF    │        │
│  │  (无需登录)      │  │  (需要登录)      │        │
│  └──────────────────┘  └──────────────────┘        │
│                                                     │
│           ─────── 或直接登录 ───────               │
│                                                     │
│  ┌────────────────────────────────────────┐        │
│  │  🔵 Continue with Google               │        │
│  └────────────────────────────────────────┘        │
│                                                     │
│           新用户? 了解 DocTalk →                   │
└─────────────────────────────────────────────────────┘
```

**改后 (After - 已登录)**:
```
┌─────────────────────────────────────────────────────┐
│  [Header: 用户头像 | Credits | Settings]            │
│                                                     │
│                    DocTalk                          │
│      与你的 PDF 对话，智能引用，精准定位            │
│                                                     │
│  ┌─────────────────────────────────────────────┐   │
│  │  📁 Drag & drop your PDF here               │   │
│  │                or                            │   │
│  │  [Choose File]                               │   │
│  └─────────────────────────────────────────────┘   │
│                                                     │
│  ─────────────── 我的文档 ───────────────          │
│                                                     │
│  ┌─────────────────────────────────────────────┐   │
│  │ 📄 report.pdf          2/5/2026   [Open]    │   │
│  │ 📄 contract.pdf        2/4/2026   [Open]    │   │
│  └─────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────┘
```

### Demo 页面设计

```
┌────────────────────────────────────────────────────────────────────────────┐
│  [DocTalk Logo]                              [登录]  [← 返回首页]          │
├────────────────────────────────────────────────────────────────────────────┤
│                                                                            │
│  ┌────────────────────────────┐  ┌─────────────────────────────────────┐  │
│  │                            │  │                                     │  │
│  │      CHAT PANEL            │  │       PDF VIEWER                    │  │
│  │                            │  │                                     │  │
│  │  [示例对话...]             │  │    [示例 PDF]                       │  │
│  │                            │  │                                     │  │
│  │                            │  │                                     │  │
│  │                            │  │                                     │  │
│  │                            │  │                                     │  │
│  │  ┌──────────────────────┐  │  │                                     │  │
│  │  │ 输入框 (5/5 剩余)    │  │  │                                     │  │
│  │  └──────────────────────┘  │  │                                     │  │
│  └────────────────────────────┘  └─────────────────────────────────────┘  │
│                                                                            │
│  ┌────────────────────────────────────────────────────────────────────┐   │
│  │  🎉 喜欢 DocTalk? 登录以保存对话并上传你自己的 PDF                 │   │
│  │                     [Continue with Google]                          │   │
│  └────────────────────────────────────────────────────────────────────┘   │
└────────────────────────────────────────────────────────────────────────────┘
```

---

## 文件改动清单

### 新增文件

| 文件路径 | 说明 |
|---------|------|
| `frontend/src/app/demo/page.tsx` | Demo 页面 |
| `frontend/public/sample.pdf` | 示例 PDF 文件 |
| `backend/app/api/documents_list.py` | 用户文档列表 API |

### 修改文件

| 文件路径 | 改动说明 |
|---------|---------|
| `frontend/src/app/page.tsx` | 重构登录页布局，添加登录检查 |
| `frontend/src/components/Header.tsx` | 调整未登录时的显示 |
| `frontend/src/i18n/locales/*.json` | 添加新的 i18n 文本 |
| `backend/app/api/documents.py` | 上传接口添加 auth 要求 |
| `backend/app/schemas/document.py` | 文档列表响应 schema |

---

## 待 Codex 审核的问题

1. **Demo PDF 选择**: 应该用什么样的示例 PDF？(建议: 一份简短的技术文档或财报摘要)

2. **消息限制执行**: 在前端限制还是后端限制？(建议: 后端，防止绕过)

3. **localStorage 迁移**: 现有用户的 localStorage 文档列表如何处理？(建议: 登录后自动关联)

4. **API 变更兼容性**: 上传接口改为必须登录会影响现有未登录上传的流程

5. **转化率权衡**: 强制登录会减少上传量，但提高付费转化率，如何平衡？

---

## 下一步

1. Codex 审核此计划并提出改进建议
2. CC 根据反馈迭代计划
3. 多轮迭代后提交用户审核
4. 用户批准后 Codex 执行实现

---

**附: 参考资料**

- [OpenAI: Start Using ChatGPT Instantly](https://openai.com/index/start-using-chatgpt-instantly/)
- [SaaS Onboarding Best Practices 2025](https://www.insaim.design/blog/saas-onboarding-best-practices-for-2025-examples)
- [NotebookLM Login Guide](https://strawdev.com/blog/notebooklm-login-accessing-googles-ai)
- [Product-Led Growth in AI SaaS](https://growthwithgary.com/p/product-led-growth-examples)
