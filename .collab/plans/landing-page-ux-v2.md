# DocTalk 登录页 UX 改进计划 v2

**日期**: 2026-02-05
**作者**: Claude Code (CC)
**审核**: Codex (CX) - Review #1
**状态**: 待第二轮 Codex 审核

---

## 变更日志

| 版本 | 日期 | 变更说明 |
|------|------|---------|
| v1 | 2026-02-05 | 初始计划 |
| v2 | 2026-02-05 | 整合 Codex Review #1 的 10 条改进建议 |

---

## 核心改进（基于 Codex 审核）

### 1. 动态主 CTA 策略

**v1 问题**: 双主 CTA 并列造成决策成本上升

**v2 改进**:
- 未登录: 突出 "试用示例"，"上传 PDF" 降为次级
- 已登录: 突出 "上传 PDF"，示例降为次级

```
未登录首屏:
┌─────────────────────────────────────────────────┐
│  [主 CTA]  ▶ 立即体验示例 PDF                   │
│  [次级]    或 登录上传你的 PDF →                │
└─────────────────────────────────────────────────┘

已登录首屏:
┌─────────────────────────────────────────────────┐
│  [主 CTA]  ▶ 上传你的 PDF                       │
│  [次级]    或 试用示例 →                        │
└─────────────────────────────────────────────────┘
```

### 2. JIT 登录模态（非跳转）

**v1 问题**: 跳转 `/auth` 页面造成上下文丢失

**v2 改进**:
- 点击 "上传 PDF" / "保存对话" → 弹出登录模态
- 模态内嵌 Google SSO + Email Magic Link
- 保留 `/auth` 作为降级与 SEO

```tsx
// 登录模态内容
<AuthModal>
  <h2>登录以继续</h2>
  <p className="text-sm text-gray-500">
    登录后可上传文档、保存对话、多设备同步
  </p>

  <Button onClick={() => signIn('google')}>
    Continue with Google
  </Button>

  <Divider>或</Divider>

  <EmailInput placeholder="输入邮箱" />
  <Button>发送登录链接</Button>

  <p className="text-xs mt-4">
    🔒 我们不使用你的文档训练模型
  </p>
</AuthModal>
```

### 3. 信任与隐私微文案前置

**v1 问题**: 文档类产品缺少隐私承诺，用户担心上传敏感文件

**v2 改进**:
- 上传区上方显示一行隐私承诺
- 可展开 "安全卡片" 查看详情

```
上传区设计:
┌─────────────────────────────────────────────────────────────┐
│  🔒 你的文档安全：不用于训练 · 加密存储 · 随时删除  [详情]  │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│        📁 拖拽 PDF 到此处，或点击选择文件                   │
│                                                             │
│        支持最大 50MB 的 PDF 文件                            │
│                                                             │
└─────────────────────────────────────────────────────────────┘

点击 [详情] 展开安全卡片:
┌─────────────────────────────────────────────────────────────┐
│  📋 安全与隐私                                              │
│                                                             │
│  ✓ 文档不用于 AI 模型训练                                  │
│  ✓ TLS 1.3 传输加密 + AES-256 存储加密                     │
│  ✓ 文档保留 30 天，可随时删除                              │
│  ✓ 数据存储在美国 AWS 数据中心                             │
│                                                             │
│  [查看隐私政策] [查看服务条款]                              │
└─────────────────────────────────────────────────────────────┘
```

### 4. 示例库多样化 + 突出核心能力

**v1 问题**: 单一示例难以触达不同用户群

**v2 改进**:
- 3-4 个精选示例（不同行业/场景）
- 每个示例预置 2-3 个引导问题
- 突出展示 "精准引用 + 页面高亮" 能力

```
示例选择页 (/demo):
┌─────────────────────────────────────────────────────────────┐
│  选择一个示例文档体验 DocTalk                               │
│                                                             │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐         │
│  │ 📊 财报分析 │  │ 📄 研究论文 │  │ 📝 合同审查 │         │
│  │ (10-K 节选) │  │ (AI 综述)   │  │ (NDA 模板)  │         │
│  │             │  │             │  │             │         │
│  │ "营收同比   │  │ "Transformer│  │ "保密期限   │         │
│  │  增长多少?" │  │  的核心创新 │  │  是多久?"   │         │
│  │             │  │  是什么?"   │  │             │         │
│  └─────────────┘  └─────────────┘  └─────────────┘         │
│                                                             │
│  💡 提示：点击引用编号 [1] 会跳转到原文并高亮显示          │
└─────────────────────────────────────────────────────────────┘
```

### 5. 游客→登录会话延续策略

**v1 问题**: 用户期望登录后 "带走" Demo 对话

**v2 改进**:
- Demo 页顶部提示 "登录可保存当前对话"
- 登录后 **复制** Demo 会话到账号（非认领）
- 示例 PDF 始终保持只读，不归属个人

```
Demo 页顶部横幅:
┌─────────────────────────────────────────────────────────────┐
│  💡 登录后可保存当前对话、上传你自己的 PDF    [登录并保存] │
└─────────────────────────────────────────────────────────────┘

登录后:
┌─────────────────────────────────────────────────────────────┐
│  ✅ 对话已保存到你的账号！                                  │
│  [继续使用示例] [上传我的 PDF]                              │
└─────────────────────────────────────────────────────────────┘
```

### 6. 废弃 localStorage 自动关联（安全考量）

**v1 问题**: 自动关联 localStorage 文档存在安全风险（无可信 claim token）

**v2 改进**:
- ❌ 不做自动关联
- ✅ 提供 "重新上传历史文档" 快捷入口
- ✅ 解释原因：出于安全考虑

```
登录后首次访问（检测到 localStorage 有历史文档）:
┌─────────────────────────────────────────────────────────────┐
│  📂 发现 3 个之前上传的文档                                │
│                                                             │
│  出于安全考虑，匿名上传的文档无法自动关联到账号。          │
│  你可以重新上传这些文件：                                   │
│                                                             │
│  - report.pdf (2/4/2026)         [重新上传]                │
│  - contract.pdf (2/3/2026)       [重新上传]                │
│  - manual.pdf (2/2/2026)         [重新上传]                │
│                                                             │
│  [全部重新上传] [稍后处理]                                 │
└─────────────────────────────────────────────────────────────┘
```

### 7. 前端 API 统一走代理

**v1 问题**: `api.ts` 直连后端，不携带 Authorization

**v2 改进**:
- 所有敏感接口改走 `/api/proxy/*`
- 路由自动注入 JWT token
- 保持非敏感接口（如健康检查）直连

```typescript
// frontend/src/lib/api.ts (改动后)

const PROXY_BASE = '/api/proxy';

// 需要授权的接口走代理
export async function uploadDocument(file: File): Promise<{ documentId: string }> {
  const formData = new FormData();
  formData.append('file', file);
  const res = await fetch(`${PROXY_BASE}/api/documents/upload`, {
    method: 'POST',
    body: formData,
  });
  // ...
}

export async function getMyDocuments(): Promise<DocumentInfo[]> {
  const res = await fetch(`${PROXY_BASE}/api/documents?mine=1`);
  // ...
}

// 不需要授权的接口可直连
export async function getDocumentStatus(docId: string): Promise<DocumentInfo> {
  const res = await fetch(`${API_BASE}/api/documents/${docId}`);
  // ...
}
```

### 8. 新增 "我的文档" 服务端列表

**v1 问题**: 文档列表依赖 localStorage，不支持多设备

**v2 改进**:
- 新增 `GET /api/documents?mine=1` 接口
- 返回当前用户的文档列表
- 首页根据登录态显示不同内容

```python
# backend/app/api/documents.py (新增)

@router.get("")
async def list_documents(
    mine: bool = Query(False),
    user: Optional[User] = Depends(get_current_user_optional),
    db: AsyncSession = Depends(get_db),
):
    """List documents for current user."""
    if mine:
        if not user:
            raise HTTPException(401, "Authentication required")
        result = await db.execute(
            select(Document)
            .where(Document.user_id == user.id)
            .order_by(Document.created_at.desc())
        )
        docs = result.scalars().all()
        return [DocumentBrief.from_orm(d) for d in docs]
    # 不带 mine 参数时返回空或 demo 文档
    return []
```

### 9. 激励文案与额度显性化

**v1 问题**: Demo 限额提示不足以传达 "登录价值"

**v2 改进**:
- CTA 附近显示激励（"登录即送 50 credits"）
- Demo 内显示剩余次数 + 登录解锁提示

```
Demo 聊天输入框上方:
┌─────────────────────────────────────────────────────────────┐
│  剩余 3/5 条消息 · 登录解锁无限对话 + 赠送 50 credits       │
└─────────────────────────────────────────────────────────────┘

登录页 CTA:
┌─────────────────────────────────────────────────────────────┐
│  [▶ Continue with Google]                                   │
│                                                             │
│  🎁 新用户赠送 50 credits（约 10 次对话）                  │
└─────────────────────────────────────────────────────────────┘
```

### 10. 高级功能延后暴露

**v1 问题**: 首屏选项过多干扰核心任务

**v2 改进**:
- 模型选择默认折叠或移到设置
- 温度/引用样式等高级选项隐藏
- 首次 aha moment 后再引导探索

---

## 更新后的用户旅程

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                           LANDING PAGE (/)                                   │
│                                                                              │
│  未登录态:                                                                   │
│  ┌──────────────────────────────────────────────────────────────────────┐   │
│  │                         DocTalk                                       │   │
│  │            与你的 PDF 对话，智能引用，精准定位                        │   │
│  │                                                                       │   │
│  │  🔒 你的文档安全：不用于训练 · 加密存储 · 随时删除                   │   │
│  │                                                                       │   │
│  │         ┌────────────────────────────────┐                           │   │
│  │         │  ▶ 立即体验示例 PDF (主 CTA)   │                           │   │
│  │         └────────────────────────────────┘                           │   │
│  │                                                                       │   │
│  │         或 登录上传你的 PDF →                                        │   │
│  │                                                                       │   │
│  │  ────────────────────────────────────────                            │   │
│  │                                                                       │   │
│  │  [🔵 Continue with Google]                                           │   │
│  │  🎁 新用户赠送 50 credits                                            │   │
│  └──────────────────────────────────────────────────────────────────────┘   │
│                                                                              │
│  已登录态:                                                                   │
│  ┌──────────────────────────────────────────────────────────────────────┐   │
│  │  [Header: 用户头像 | 50 credits | Settings]                          │   │
│  │                                                                       │   │
│  │  🔒 你的文档安全：不用于训练 · 加密存储 · 随时删除                   │   │
│  │  ┌──────────────────────────────────────────────────────────────┐    │   │
│  │  │  📁 拖拽 PDF 到此处，或点击选择文件 (主 CTA)                 │    │   │
│  │  └──────────────────────────────────────────────────────────────┘    │   │
│  │                                                                       │   │
│  │  或 试用示例 →                                                       │   │
│  │                                                                       │   │
│  │  ───────────────── 我的文档 ─────────────────                        │   │
│  │                                                                       │   │
│  │  📄 report.pdf         2/5/2026   [Open] [🗑]                        │   │
│  │  📄 contract.pdf       2/4/2026   [Open] [🗑]                        │   │
│  └──────────────────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────────────┘
                                        │
            ┌───────────────────────────┼───────────────────────────┐
            ▼                           ▼                           ▼
┌───────────────────────┐  ┌───────────────────────┐  ┌───────────────────────┐
│    DEMO 选择页        │  │     AUTH 模态         │  │    文档阅读页         │
│    /demo              │  │     (模态弹窗)        │  │    /d/{id}            │
│                       │  │                       │  │                       │
│  选择示例:            │  │  登录以继续           │  │  Chat | PDF           │
│  - 财报分析           │  │                       │  │  (完整功能)           │
│  - 研究论文           │  │  [Google 登录]        │  │                       │
│  - 合同审查           │  │  [Email 登录]         │  │                       │
│                       │  │                       │  │                       │
│  提示: 5 条消息限制   │  │  🔒 隐私承诺          │  │                       │
│  登录可保存对话       │  │  🎁 赠送 50 credits   │  │                       │
└───────────────────────┘  └───────────────────────┘  └───────────────────────┘
            │                           │
            ▼                           │
┌───────────────────────┐               │
│    DEMO 阅读页        │               │
│    /demo/{sample}     │ ──登录后──→──┘
│                       │
│  Chat (5条限制)       │
│  + PDF 示例           │
│                       │
│  [登录保存对话]       │
└───────────────────────┘
```

---

## 实现优先级（更新后）

### P0 - 立即实施

| 任务 | 文件 | 工作量 |
|------|------|--------|
| 后端上传接口 require_auth | `backend/app/api/documents.py` | 低 |
| 前端 API 走代理 | `frontend/src/lib/api.ts` | 低 |
| 首页 CTA 动态策略 | `frontend/src/app/page.tsx` | 中 |
| 隐私微文案组件 | `frontend/src/components/PrivacyBadge.tsx` | 低 |
| Demo 页（前端限额） | `frontend/src/app/demo/page.tsx` | 中 |

### P1 - 本周完成

| 任务 | 文件 | 工作量 |
|------|------|--------|
| 服务端文档列表 API | `backend/app/api/documents.py` | 低 |
| 登录模态组件 | `frontend/src/components/AuthModal.tsx` | 中 |
| Email Magic Link | `frontend/src/lib/auth.ts` + 邮件服务 | 中 |
| 示例库（3-4 个 PDF） | `frontend/public/samples/` | 低 |
| 激励文案与 credits 显示 | `frontend/src/components/` | 低 |
| i18n 文本更新 | `frontend/src/i18n/locales/*.json` | 低 |

### P2 - 下个迭代

| 任务 | 说明 |
|------|------|
| 服务端 Demo 配额 | sessions 表加 is_demo 字段 |
| 历史文档迁移提示 | localStorage 检测 + 重新上传引导 |
| 高级选项折叠 | 模型选择等移入设置 |
| 埋点与 A/B 测试 | 关键事件追踪 |
| Microsoft SSO | Azure AD Provider |

---

## 文件改动清单（更新后）

### 新增文件

| 文件路径 | 说明 |
|---------|------|
| `frontend/src/app/demo/page.tsx` | Demo 选择页 |
| `frontend/src/app/demo/[sample]/page.tsx` | Demo 阅读页 |
| `frontend/src/components/AuthModal.tsx` | 登录模态 |
| `frontend/src/components/PrivacyBadge.tsx` | 隐私承诺组件 |
| `frontend/public/samples/` | 示例 PDF 目录 |

### 修改文件

| 文件路径 | 改动说明 |
|---------|---------|
| `frontend/src/app/page.tsx` | 动态 CTA、服务端文档列表 |
| `frontend/src/lib/api.ts` | 敏感接口走 /api/proxy |
| `frontend/src/lib/auth.ts` | 添加 Email Provider（可选） |
| `frontend/src/components/Header.tsx` | 登录态显示 |
| `frontend/src/i18n/locales/*.json` | 新增 i18n 文本 |
| `backend/app/api/documents.py` | 上传 require_auth、列表 API |
| `backend/app/schemas/document.py` | DocumentBrief schema |

---

## 风险评估（更新后）

### 流失风险

| 场景 | 预估流失 | 缓解措施 |
|------|---------|---------|
| 上传前要求登录 | 15-35% | JIT 模态、激励文案、Demo 体验 |
| Demo 消息限制 | 10-20% | 明确显示限制、登录解锁提示 |
| localStorage 不迁移 | 5-10% | 重新上传快捷入口、解释原因 |

### 预期收益

| 指标 | 预期变化 |
|------|---------|
| 注册转化率 | +50-100% |
| 付费转化率 | +30-50% |
| 用户留存（7 日） | +20-30% |
| 多设备使用率 | +200% |

---

## 待第二轮审核的问题

1. **示例 PDF 来源**: 使用公开文档还是自制内容？版权考量？

2. **Email Magic Link 优先级**: MVP 阶段是否需要？还是 Google SSO 足够？

3. **Demo 消息限制数量**: 5 条是否合适？还是 3 条更能推动转化？

4. **隐私政策页面**: 是否需要在 MVP 阶段完成完整的隐私政策页面？

5. **埋点方案**: 推荐使用什么分析工具？Vercel Analytics、Mixpanel、Posthog？

---

## 下一步

1. Codex 第二轮审核，聚焦实现细节与优先级
2. CC 根据反馈生成最终 v3 计划
3. 提交用户审核
4. 用户批准后 Codex 执行

---

**附: 参考资料**

- Codex Review #1: `.collab/reviews/landing-page-ux-review-1.md`
- v1 计划: `.collab/plans/landing-page-ux-v1.md`
